---
title: "New Secret Plugin Protocol"
description: "Learn how to keep your sensitive data generated by Porter safe and sound"
date: "2022-05-31"
authorname: "Yingrong Zhao"
author: "@vinozzz"
authorlink: "https://twitter.com/GaysianB612"
authorimage: "https://github.com/VinozzZ.png"
tags: ["best-practices", "plugins"]
summary: |
    Keep sensitive data generated by Porter safe and sound with the new secret plugin protocol
---

As we approaching closer to our v1 release, we have made another improvement in Porter to make sure any sensitive data generated or referenced by Porter is stored in a secure location.
The newly updated secret plugin protocol enables Porter to persist sensitive data in a secret plugin store instead of Porter's storage database.

Previously Porter only uses plugins for retrieving secrets from a secret store. When it comes to storing data generated by bundles, Porter uses storage plugins like Mongo as its backend database solution. If a sensitive data, such as a database connection string, were populated during a Porter execution, it would be stored in a Mongo database in plain text, which could lead to potential data breach.
Now Porter requires users to configure a secret store to hold any data that has been flaged as sensitive in a bundle. 

Let's walk through how to utilize this new feature by updating your Porter configuration file and picking a secret plugin that works best for your usecase.

If you haven't installed the latest Porter v1 release, please follow the instruction [here](https://release-v1.porter.sh/install/#prerelease).

After the installation, let's try to install a bundle that works with sensitive data with just the default configurations in Porter.

```
porter install --reference ghcr.io/getporter/examples/sensitive-data --param password=123a123
```

You should get an error with an output that looks like this:
```
Building bundle ===>
Defaulting the type of output name to file
Copying porter runtime ===> 
Copying mixins ===> 
Copying mixin exec ===> 

Generating Dockerfile =======>

Writing Dockerfile =======>
Building invocation image
failed to save sensitive param to secrete store: rpc error: code = Unknown desc = The default secrets plugin, secrets.porter.host, does not support persisting secrets: not implemented
```

In this example bundle, there's a sensitive parameter named as `password` and a sensitive output called `name`.

By default, Porter does not provide a built-in solution to persist sensitive data. Any bundle that references or produces sensitive data will fail to execute. 

Now let's configure Porter to persist sensitive data using plain text file through the [filesystem](https://release-v1.porter.sh/plugins/filesystem/) plugin.

```yaml
# ~/.porter/config.toml
default-secrets- = "mysecret"

secrets:
  name = "mysecrets"
  plugin = "filesystem"
```

The [filesystem](https://release-v1.porter.sh/plugins/filesystem/) plugin resolves and stores sensitive bundle parameters and outpus as plaintext files in your PORTER_HOME directory.
Note: the filesystem plugin is only intended for testing and local development usage. It's not intended to be used in production. Please see at the end of this post on how to pick a plugin that is suitable for production usecase.

Now you have a secret store set up, we can try to install the example bundle again.

```
porter install --reference ghcr.io/getporter/examples/sensitive-data --param password=123a123
```

Once the installation process finishes, you should see outputs like below:

```
executing install action from sensitive-data (installation: /sensitive-data)
Install Hello World
Hello, installing example-bundle with password: *******
execution completed successfully!
```

If you inspect your Porter storage database, in this case, it's a [mongodb instance](https://release-v1.porter.sh/plugins/mongodb-docker/), you should see the value of the `password` parameter is a reference to a [secret](https://release-v1.porter.sh/parameters/#user-specified-values).

```
parameters: [
  {
    source: { secret: '01G4DY1RTQVN0DWK67NYJ6TWFH-password' },
    name: 'password'
  }
]
```

Porter no longer stores the sensitive data through its storage plugins.

Instead, we can find our "password" in our [filesystem](https://release-v1.porter.sh/plugins/filesystem/) plugin. In your PORTER_HOME directory, you should find a subdirectory named `secrets`. Each file under this directory contains the sensitive value corresponding to a sensitive parameter or sensitive output from a run of a bundle. 

This is why it's important to choose a secure secret plugin for your production environment so that your sensitiva data is protected.

Here are some plugin solutions that we recommand you to use in production:
- [Azure Key Vault](https://release-v1.porter.sh/plugins/azure/#secrets)
- [Kubernetes Secrets](https://release-v1.porter.sh/plugins/kubernetes/#secrets)
- [Hashicorp Vault](https://release-v1.porter.sh/plugins/hashicorp/)

Give them a try and let us know how it works for you! If there is a secret solution that you would like to use with Porter, let us know, and we can help make that happen more quickly.